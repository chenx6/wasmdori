var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,l=(t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,o=(e,t)=>{for(var a in t||(t={}))n.call(t,a)&&l(e,a,t[a]);if(r)for(var a of r(t))s.call(t,a)&&l(e,a,t[a]);return e},c=(e,r)=>t(e,a(r));const i={};import{a as u,h as p,t as d}from"./vendor.d8d0fb72.js";import{t as f,g as b,j as g,e as m,a as w,s as v,n as h,b as y,c as _}from"./utils.b80295f2.js";let j,k=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});k.decode();let B=null;function S(){return null!==B&&B.buffer===j.memory.buffer||(B=new Uint8Array(j.memory.buffer)),B}function P(e,t){return k.decode(S().subarray(e,e+t))}const C=new Array(32).fill(void 0);C.push(void 0,null,!0,!1);let O=C.length;function x(e){O===C.length&&C.push(C.length+1);const t=O;return O=C[t],C[t]=e,t}function A(e){return C[e]}let T=0,E=new TextEncoder("utf-8");const F="function"==typeof E.encodeInto?function(e,t){return E.encodeInto(e,t)}:function(e,t){const a=E.encode(e);return t.set(a),{read:e.length,written:a.length}};function I(e,t,a){if(void 0===a){const a=E.encode(e),r=t(a.length);return S().subarray(r,r+a.length).set(a),T=a.length,r}let r=e.length,n=t(r);const s=S();let l=0;for(;l<r;l++){const t=e.charCodeAt(l);if(t>127)break;s[n+l]=t}if(l!==r){0!==l&&(e=e.slice(l)),n=a(n,r,r=l+3*e.length);const t=S().subarray(n+l,n+r);l+=F(e,t).written}return T=l,n}let M=null;function R(){return null!==M&&M.buffer===j.memory.buffer||(M=new Int32Array(j.memory.buffer)),M}function W(e){const t=A(e);return function(e){e<36||(C[e]=O,O=e)}(e),t}let D=32;function q(e){if(1==D)throw new Error("out of js stack");return C[--D]=e,D}Object.freeze({Free:0,0:"Free",Multi:1,1:"Multi",VS:2,2:"VS"}),async function e(t){void 0===t&&(t=new URL("bgp_team_builder_bg.wasm",i.url));const a={wbg:{}};a.wbg.__wbindgen_json_parse=function(e,t){return x(JSON.parse(P(e,t)))},a.wbg.__wbindgen_json_serialize=function(e,t){const a=A(t);var r=I(JSON.stringify(void 0===a?null:a),j.__wbindgen_malloc,j.__wbindgen_realloc),n=T;R()[e/4+1]=n,R()[e/4+0]=r},a.wbg.__wbg_new_59cb74e423758ede=function(){return x(new Error)},a.wbg.__wbg_stack_558ba5917b466edd=function(e,t){var a=I(A(t).stack,j.__wbindgen_malloc,j.__wbindgen_realloc),r=T;R()[e/4+1]=r,R()[e/4+0]=a},a.wbg.__wbg_error_4bb6c2a97407129a=function(e,t){try{console.error(P(e,t))}finally{j.__wbindgen_free(e,t)}},a.wbg.__wbindgen_object_drop_ref=function(e){W(e)},a.wbg.__wbindgen_throw=function(e,t){throw new Error(P(e,t))},("string"==typeof t||"function"==typeof Request&&t instanceof Request||"function"==typeof URL&&t instanceof URL)&&(t=fetch(t));const{instance:r,module:n}=await async function(e,t){if("function"==typeof Response&&e instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(e,t)}catch(a){if("application/wasm"==e.headers.get("Content-Type"))throw a;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",a)}const r=await e.arrayBuffer();return await WebAssembly.instantiate(r,t)}{const a=await WebAssembly.instantiate(e,t);return a instanceof WebAssembly.Instance?{instance:a,module:e}:a}}(await t,a);return j=r.exports,e.__wbindgen_wasm_module=n,j}("./bgp_team_builder_bg.wasm");const L=(e,t)=>c(o({},e),{parameter:t.target.value}),N=(e,t)=>c(o({},e),{prop:t.target.value}),U=(e,t)=>{let a=e.selectedCharacters,r=parseInt(t),n=a.includes(r)?a.filter((e=>e!=r)):a.push(r)&&a;return c(o({},e),{selectedCharacters:n})},z=(e,t)=>c(o({},e),{propBonus:parseFloat(t.target.value)/100}),J=(e,t)=>c(o({},e),{characterBonus:parseFloat(t.target.value)/100}),V=(e,t)=>c(o({},e),{allFitBonus:parseFloat(t.target.value)/100}),H=(e,t)=>c(o({},e),{eventType:parseInt(t.target.value)}),G=e=>{let t=[],a=0,r=0,n=0;e.filter((e=>"BPM"===e.type)).sort(((e,t)=>e.beat-t.beat)).forEach((e=>{n+=(e.beat-r)*a,r=e.beat,a=60/e.bpm,t.unshift({beat:r,time:n,timePerBeat:a})}));const s=e=>{for(let a=0;a<t.length;a++){let r=t[a];if(e>=r.beat)return r.time+(e-r.beat)*r.timePerBeat}return 0},l=e.find((e=>"System"===e.type&&"cmd_fever_start.wav"===e.data)),o=e.find((e=>"System"===e.type&&"cmd_fever_end.wav"===e.data)),c=l?l.beat:-1,i=o?o.beat:-1;let u=[];return e.forEach((e=>{switch(e.type){case"Single":case"Directional":u.push({time:s(e.beat),fever:e.beat>=c&&e.beat<=i,skill:e.skill});break;case"Slide":case"Long":e.connections.forEach((e=>{e.hidden||u.push({time:s(e.beat),fever:e.beat>=c&&e.beat<=i,skill:e.skill})}))}})),u.sort(((e,t)=>e.time-t.time||!!t.skill-!!e.skill)),u},K=e=>{if(5!=e.selectedCharacters.length||null===e.selectedProfile)return e;let t={prop:e.prop,parameter:e.parameter,characters:e.selectedCharacters,prop_bonus:e.propBonus,character_bonus:e.characterBonus,all_fit_bonus:e.allFitBonus};const a=Date.now();let r=function(e,t,a,r,n,s,l,o){try{return W(j.gene_score(q(e),q(t),q(a),q(r),q(n),q(s),q(l),o))}finally{C[D++]=void 0,C[D++]=void 0,C[D++]=void 0,C[D++]=void 0,C[D++]=void 0,C[D++]=void 0,C[D++]=void 0}}(t,e.rawCards,e.selectedProfile,e.rawCharacters,e.rawBands,e.selectedSong,e.rawSkills,e.eventType);return console.log("Time: %d",Date.now()-a),c(o({},e),{bestTeam:r})},Q=e=>p("div",{class:"row p-1"},[p("div",{class:"col"},[p("label",{},d(e.language.selectCharacter)),p("div",{class:"col input-group"},e.characters.map((t=>((e,t)=>t.characterName[e.server]&&p("div",{class:"p-1"},[p("label",{for:t.id,class:"form-check-label"},d(t.characterName[e.server])),p("input",{type:"checkbox",name:t.id,class:"form-check-input",onclick:[U,t.id]})]))(e,t))))])]),X=e=>p("div",{class:"col"},[p("label",{for:"prop"},d(e.language.selectProperty)),p("select",{name:"prop",id:"prop",class:"form-select",onchange:N},[p("option",{value:"happy"},d("Happy")),p("option",{value:"pure"},d("Pure")),p("option",{value:"cool"},d("Cool")),p("option",{value:"powerful"},d("Powerful"))])]),Y=e=>p("div",{class:"col"},[p("label",{for:"parameter"},d(e.language.selectParameter)),p("select",{name:"parameter",id:"parameter",class:"form-select",onchange:L},[p("option",{value:"performance"},d(e.language.performance)),p("option",{value:"technique"},d(e.language.technique)),p("option",{value:"visual"},d(e.language.visual))])]),Z=e=>p("div",{class:"row p-1"},[p("div",{class:"col"},[p("label",{class:"form-label"},d(e.language.propBonus)),p("div",{class:"input-group"},[p("input",{type:"number",step:"10",min:"0",max:"100",class:"form-control",onchange:z}),p("span",{class:"input-group-text"},d("%"))])]),p("div",{class:"col"},[p("label",{class:"form-label"},d(e.language.characterBonus)),p("div",{class:"input-group"},[p("input",{type:"number",step:"10",min:"0",max:"100",class:"form-control",onchange:J}),p("span",{class:"input-group-text"},d("%"))])]),p("div",{class:"col"},[p("label",{class:"form-label"},d(e.language.allFitBonus)),p("div",{class:"input-group"},[p("input",{type:"number",step:"10",min:"0",max:"100",class:"form-control",onchange:V}),p("span",{class:"input-group-text"},d("%"))])])]),$=e=>p("div",{class:"row p-1"},[p("div",{class:"col"},[p("label",{class:"form-label"},d(e.language.selectMode)),p("select",{class:"form-select",onchange:H},[...[e.language.freePlay,e.language.multiPlay,e.language.vsPlay].map(((e,t)=>p("option",{value:t.toString()},d(e))))])])]),ee=e=>p("div",{class:"row justify-content-md-center p-1"},Object.values(e.bestTeam).map((t=>p("div",{class:"card col"},[p("img",{src:_(e.rawCards[t.card_id],t.card_id),width:"64",class:"card-img-top"}),p("ul",{class:"list-group list-group-flush"},[p("li",{class:"list-group-item text-truncate"},d(e.rawCards[t.card_id].prefix[e.server]))])]))));u({init:[{characters:[],selectedCharacters:[],server:0,language:f[b()],prop:"happy",parameter:"happy",propBonus:0,characterBonus:0,allFitBonus:0,eventType:0,bestTeam:[],rawCharacters:{},rawBands:null,rawCards:null,rawSkills:null,profiles:[],selectedProfile:{},selectedSong:{}},g("data/characters.json",((e,t)=>{let a=[];for(const r of Object.keys(t))a.push(c(o({},t[r]),{id:r}));return c(o({},e),{characters:a,rawCharacters:t})})),g("data/bands.json",m),g("data/cards.json",w),g("data/125.expert.json",((e,t)=>c(o({},e),{selectedSong:G(t)}))),g("data/skills.json",((e,t)=>c(o({},e),{rawSkills:t}))),v()],view:e=>p("div",{},[h(e),p("div",{class:"container"},[y(e),Q(e),p("div",{class:"row p-1"},[Y(e),X(e)]),Z(e),$(e),p("div",{class:"row p-1"},[p("div",{claas:"col"},[p("button",{class:"btn btn-primary",onclick:[K]},d(e.language.generate))])]),0!=e.bestTeam.length&&ee(e)])]),node:document.getElementById("app")});
//# sourceMappingURL=team_builder.0b2b2fd8.js.map
