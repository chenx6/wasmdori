var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,o=(t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,l=(e,t)=>{for(var a in t||(t={}))n.call(t,a)&&o(e,a,t[a]);if(r)for(var a of r(t))s.call(t,a)&&o(e,a,t[a]);return e},c=(e,r)=>t(e,a(r));const i={};import{a as u,h as p,t as d}from"./vendor.d8d0fb72.js";import{t as f,g as b,j as g,d as m,a as w,s as v,n as h,S as y,b as _}from"./utils.ec7aa953.js";let k,j=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});j.decode();let B=null;function S(){return null!==B&&B.buffer===k.memory.buffer||(B=new Uint8Array(k.memory.buffer)),B}function C(e,t){return j.decode(S().subarray(e,e+t))}const O=new Array(32).fill(void 0);O.push(void 0,null,!0,!1);let P=O.length;function x(e){P===O.length&&O.push(O.length+1);const t=P;return P=O[t],O[t]=e,t}function A(e){return O[e]}let E=0,I=new TextEncoder("utf-8");const F="function"==typeof I.encodeInto?function(e,t){return I.encodeInto(e,t)}:function(e,t){const a=I.encode(e);return t.set(a),{read:e.length,written:a.length}};function T(e,t,a){if(void 0===a){const a=I.encode(e),r=t(a.length);return S().subarray(r,r+a.length).set(a),E=a.length,r}let r=e.length,n=t(r);const s=S();let o=0;for(;o<r;o++){const t=e.charCodeAt(o);if(t>127)break;s[n+o]=t}if(o!==r){0!==o&&(e=e.slice(o)),n=a(n,r,r=o+3*e.length);const t=S().subarray(n+o,n+r);o+=F(e,t).written}return E=o,n}let R=null;function W(){return null!==R&&R.buffer===k.memory.buffer||(R=new Int32Array(k.memory.buffer)),R}function D(e){const t=A(e);return function(e){e<36||(O[e]=P,P=e)}(e),t}let q=32;function L(e){if(1==q)throw new Error("out of js stack");return O[--q]=e,q}!async function e(t){void 0===t&&(t=new URL("wasmdori_bg.wasm",i.url));const a={wbg:{}};a.wbg.__wbindgen_json_parse=function(e,t){return x(JSON.parse(C(e,t)))},a.wbg.__wbindgen_json_serialize=function(e,t){const a=A(t);var r=T(JSON.stringify(void 0===a?null:a),k.__wbindgen_malloc,k.__wbindgen_realloc),n=E;W()[e/4+1]=n,W()[e/4+0]=r},a.wbg.__wbg_new_59cb74e423758ede=function(){return x(new Error)},a.wbg.__wbg_stack_558ba5917b466edd=function(e,t){var a=T(A(t).stack,k.__wbindgen_malloc,k.__wbindgen_realloc),r=E;W()[e/4+1]=r,W()[e/4+0]=a},a.wbg.__wbg_error_4bb6c2a97407129a=function(e,t){try{console.error(C(e,t))}finally{k.__wbindgen_free(e,t)}},a.wbg.__wbindgen_object_drop_ref=function(e){D(e)},("string"==typeof t||"function"==typeof Request&&t instanceof Request||"function"==typeof URL&&t instanceof URL)&&(t=fetch(t));const{instance:r,module:n}=await async function(e,t){if("function"==typeof Response&&e instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(e,t)}catch(a){if("application/wasm"==e.headers.get("Content-Type"))throw a;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",a)}const r=await e.arrayBuffer();return await WebAssembly.instantiate(r,t)}{const a=await WebAssembly.instantiate(e,t);return a instanceof WebAssembly.Instance?{instance:a,module:e}:a}}(await t,a);return k=r.exports,e.__wbindgen_wasm_module=n,k}("./wasmdori_bg.wasm");const M=(e,t)=>c(l({},e),{parameter:t.target.value}),N=(e,t)=>c(l({},e),{prop:t.target.value}),U=(e,t)=>{let a=e.selectedCharacters,r=parseInt(t),n=a.includes(r)?a.filter((e=>e!=r)):a.push(r)&&a;return c(l({},e),{selectedCharacters:n})},J=(e,t)=>c(l({},e),{propBonus:parseFloat(t.target.value)/100}),z=(e,t)=>c(l({},e),{characterBonus:parseFloat(t.target.value)/100}),H=(e,t)=>c(l({},e),{allFitBonus:parseFloat(t.target.value)/100}),G=e=>{let t=[],a=0,r=0,n=0;e.filter((e=>"BPM"===e.type)).sort(((e,t)=>e.beat-t.beat)).forEach((e=>{n+=(e.beat-r)*a,r=e.beat,a=60/e.bpm,t.unshift({beat:r,time:n,timePerBeat:a})}));const s=e=>{for(let a=0;a<t.length;a++){let r=t[a];if(e>=r.beat)return r.time+(e-r.beat)*r.timePerBeat}return 0},o=e.find((e=>"System"===e.type&&"cmd_fever_start.wav"===e.data)),l=e.find((e=>"System"===e.type&&"cmd_fever_end.wav"===e.data)),c=o?o.beat:-1,i=l?l.beat:-1;let u=[];return e.forEach((e=>{switch(e.type){case"Single":case"Directional":u.push({time:s(e.beat),fever:e.beat>=c&&e.beat<=i,skill:e.skill});break;case"Slide":case"Long":e.connections.forEach((e=>{e.hidden||u.push({time:s(e.beat),fever:e.beat>=c&&e.beat<=i,skill:e.skill})}))}})),u.sort(((e,t)=>e.time-t.time||!!t.skill-!!e.skill)),u},K=e=>{if(5!=e.selectedCharacters.length||null===e.selectedProfile)return e;let t={prop:e.prop,parameter:e.parameter,characters:e.selectedCharacters,prop_bonus:e.propBonus,character_bonus:e.characterBonus,all_fit_bonus:e.allFitBonus};const a=Date.now();let r=function(e,t,a,r,n,s,o){try{return D(k.gene_score(L(e),L(t),L(a),L(r),L(n),L(s),L(o)))}finally{O[q++]=void 0,O[q++]=void 0,O[q++]=void 0,O[q++]=void 0,O[q++]=void 0,O[q++]=void 0,O[q++]=void 0}}(t,e.rawCards,e.selectedProfile,e.rawCharacters,e.rawBands,e.selectedSong,e.rawSkills);return console.log("Time: %d",Date.now()-a),c(l({},e),{bestTeam:r})},Q=e=>p("div",{class:"row p-1"},[p("div",{class:"col"},[p("label",{for:"server"},d(e.language.selectServer)),p("select",{name:"server",id:"server",class:"form-select",onchange:y},[p("option",{value:"0"},d("日本")),p("option",{value:"1"},d("International")),p("option",{value:"2"},d("繁体中文")),p("option",{value:"3"},d("简体中文"))])])]),V=e=>p("div",{class:"row p-1"},[p("div",{class:"col"},[p("label",{},d(e.language.selectCharacter)),p("div",{class:"col input-group"},e.characters.map((t=>((e,t)=>t.characterName[e.server]&&p("div",{class:"p-1"},[p("label",{for:t.id,class:"form-check-label"},d(t.characterName[e.server])),p("input",{type:"checkbox",name:t.id,class:"form-check-input",onclick:[U,t.id]})]))(e,t))))])]),X=e=>p("div",{class:"col"},[p("label",{for:"prop"},d(e.language.selectProperty)),p("select",{name:"prop",id:"prop",class:"form-select",onchange:N},[p("option",{value:"happy"},d("Happy")),p("option",{value:"pure"},d("Pure")),p("option",{value:"cool"},d("Cool")),p("option",{value:"powerful"},d("Powerful"))])]),Y=e=>p("div",{class:"col"},[p("label",{for:"parameter"},d(e.language.selectParameter)),p("select",{name:"parameter",id:"parameter",class:"form-select",onchange:M},[p("option",{value:"performance"},d(e.language.performance)),p("option",{value:"technique"},d(e.language.technique)),p("option",{value:"visual"},d(e.language.visual))])]),Z=e=>p("div",{class:"row p-1"},[p("div",{class:"col"},[p("label",{class:"form-label"},d(e.language.propBonus)),p("div",{class:"input-group"},[p("input",{type:"number",step:"10",min:"0",max:"100",class:"form-control",onchange:J}),p("span",{class:"input-group-text"},d("%"))])]),p("div",{class:"col"},[p("label",{class:"form-label"},d(e.language.characterBonus)),p("div",{class:"input-group"},[p("input",{type:"number",step:"10",min:"0",max:"100",class:"form-control",onchange:z}),p("span",{class:"input-group-text"},d("%"))])]),p("div",{class:"col"},[p("label",{class:"form-label"},d(e.language.allFitBonus)),p("div",{class:"input-group"},[p("input",{type:"number",step:"10",min:"0",max:"100",class:"form-control",onchange:H}),p("span",{class:"input-group-text"},d("%"))])])]),$=e=>p("div",{class:"row justify-content-md-center p-1"},Object.values(e.bestTeam).map((t=>p("div",{class:"card col"},[p("img",{src:_(e.rawCards[t.card_id],t.card_id),width:"64",class:"card-img-top"}),p("ul",{class:"list-group list-group-flush"},[p("li",{class:"list-group-item text-truncate"},d(e.rawCards[t.card_id].prefix[e.server]))])]))));u({init:[{characters:[],selectedCharacters:[],server:0,language:f[b()],prop:"happy",parameter:"happy",propBonus:0,characterBonus:0,allFitBonus:0,bestTeam:[],rawCharacters:{},rawBands:null,rawCards:null,rawSkills:null,profiles:[],selectedProfile:{},selectedSong:{}},g("data/characters.json",((e,t)=>{let a=[];for(const r of Object.keys(t))a.push(c(l({},t[r]),{id:r}));return c(l({},e),{characters:a,rawCharacters:t})})),g("data/bands.json",m),g("data/cards.json",w),g("data/125.expert.json",((e,t)=>c(l({},e),{selectedSong:G(t)}))),g("data/skills.json",((e,t)=>c(l({},e),{rawSkills:t}))),v()],view:e=>p("div",{},[h(e),p("div",{class:"container"},[Q(e),V(e),p("div",{class:"row p-1"},[Y(e),X(e)]),Z(e),p("div",{class:"row p-1"},[p("div",{claas:"col"},[p("button",{class:"btn btn-primary",onclick:[K]},d(e.language.generate))])]),0!=e.bestTeam.length&&$(e)])]),node:document.getElementById("app")});
